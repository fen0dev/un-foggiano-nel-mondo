<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Un Foggiano nel Mondo</title>
    <link rel="stylesheet" href="../../styles/style.css">
    <link rel="stylesheet" href="../../styles/admin.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-header">
                <h1>üèÜ Un Foggiano nel Mondo</h1>
                <p>Dashboard Amministratore</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="adminKey">Chiave Admin</label>
                    <input type="password" id="adminKey" placeholder="Inserisci la chiave..." required>
                </div>
                <button type="submit" class="btn-login">
                    <span>Accedi</span>
                    <span class="btn-icon">‚Üí</span>
                </button>
                <p id="loginError" class="login-error"></p>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üèÜ Admin</h2>
                <span class="version">v1.0</span>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="overview">
                    <span class="nav-icon">üìä</span>
                    <span>Panoramica</span>
                </a>
                <a href="#" class="nav-item" data-section="iscrizioni">
                    <span class="nav-icon">üìã</span>
                    <span>Iscrizioni</span>
                </a>
                <a href="#" class="nav-item" data-section="analytics">
                    <span class="nav-icon">üìà</span>
                    <span>Analytics</span>
                </a>
                <a href="#" class="nav-item" data-section="logs">
                    <span class="nav-icon">üìù</span>
                    <span>Log Attivit√†</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn-logout">
                    <span>üö™</span>
                    <span>Esci</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-title">
                    <h1 id="pageTitle">Panoramica</h1>
                    <p id="lastUpdate">Ultimo aggiornamento: --</p>
                </div>
                <div class="header-actions">
                    <button id="refreshBtn" class="btn-refresh" title="Aggiorna">
                        <span>üîÑ</span>
                    </button>
                    <button id="exportBtn" class="btn-export">
                        <span>üì•</span>
                        <span>Esporta CSV</span>
                    </button>
                </div>
            </header>

            <!-- Overview Section -->
            <section id="overviewSection" class="section active">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card" data-type="total">
                        <div class="stat-icon">üèüÔ∏è</div>
                        <div class="stat-info">
                            <span class="stat-value" id="statTotal">--</span>
                            <span class="stat-label">Iscrizioni Totali</span>
                        </div>
                    </div>
                    <div class="stat-card" data-type="approved">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <span class="stat-value" id="statApproved">--</span>
                            <span class="stat-label">Approvate</span>
                        </div>
                    </div>
                    <div class="stat-card" data-type="pending">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-info">
                            <span class="stat-value" id="statPending">--</span>
                            <span class="stat-label">In Attesa</span>
                        </div>
                    </div>
                    <div class="stat-card" data-type="rejected">
                        <div class="stat-icon">‚ùå</div>
                        <div class="stat-info">
                            <span class="stat-value" id="statRejected">--</span>
                            <span class="stat-label">Rifiutate</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row">
                    <div class="chart-card">
                        <h3>Iscrizioni per Paese</h3>
                        <div id="countryChart" class="chart-container">
                            <div class="chart-bars" id="countryBars"></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Statistiche Puzzle</h3>
                        <div class="puzzle-stats">
                            <div class="puzzle-stat">
                                <span class="puzzle-value" id="puzzleStarted">--</span>
                                <span class="puzzle-label">Iniziati</span>
                            </div>
                            <div class="puzzle-stat">
                                <span class="puzzle-value" id="puzzleCompleted">--</span>
                                <span class="puzzle-label">Completati</span>
                            </div>
                            <div class="puzzle-stat">
                                <span class="puzzle-value" id="puzzleRate">--%</span>
                                <span class="puzzle-label">Tasso Completamento</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Iscrizioni -->
                <div class="recent-card">
                    <div class="card-header">
                        <h3>Iscrizioni Recenti</h3>
                        <a href="#" class="view-all" data-section="iscrizioni">Vedi tutte ‚Üí</a>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Squadra</th>
                                    <th>Capitano</th>
                                    <th>Paese</th>
                                    <th>Data</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentTable">
                                <tr>
                                    <td colspan="5" class="loading">Caricamento...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Iscrizioni Section -->
            <section id="iscrizioniSection" class="section">
                <!-- Filters -->
                <div class="filters-bar">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Cerca squadra, capitano, email...">
                    </div>
                    <div class="filter-group">
                        <select id="statusFilter">
                            <option value="">Tutti gli status</option>
                            <option value="pending">‚è≥ In Attesa</option>
                            <option value="approved">‚úÖ Approvate</option>
                            <option value="rejected">‚ùå Rifiutate</option>
                        </select>
                        <select id="countryFilter">
                            <option value="">Tutti i paesi</option>
                            <option value="IT">üáÆüáπ Italia</option>
                            <option value="US">üá∫üá∏ Stati Uniti</option>
                            <option value="GB">üá¨üáß Regno Unito</option>
                            <option value="DE">üá©üá™ Germania</option>
                            <option value="FR">üá´üá∑ Francia</option>
                            <option value="ES">üá™üá∏ Spagna</option>
                            <option value="BR">üáßüá∑ Brasile</option>
                            <option value="AR">üá¶üá∑ Argentina</option>
                            <option value="AU">üá¶üá∫ Australia</option>
                            <option value="OTHER">üåç Altro</option>
                        </select>
                    </div>
                </div>

                <!-- Bulk Actions -->
                <div id="bulkActions" class="bulk-actions" style="display: none;">
                    <span id="selectedCount">0 selezionati</span>
                    <button class="btn-bulk approve" id="bulkApprove">‚úÖ Approva</button>
                    <button class="btn-bulk reject" id="bulkReject">‚ùå Rifiuta</button>
                    <button class="btn-bulk delete" id="bulkDelete">üóëÔ∏è Elimina</button>
                </div>

                <!-- Table -->
                <div class="table-container full">
                    <table class="data-table selectable">
                        <thead>
                            <tr>
                                <th class="checkbox-col">
                                    <input type="checkbox" id="selectAll">
                                </th>
                                <th>Squadra</th>
                                <th>Capitano</th>
                                <th>Email</th>
                                <th>Telefono</th>
                                <th>Paese</th>
                                <th>Giocatori</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="iscrizioniTable">
                            <tr>
                                <td colspan="10" class="loading">Caricamento...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button id="prevPage" class="btn-page" disabled>‚Üê Precedente</button>
                    <span id="pageInfo">Pagina 1 di 1</span>
                    <button id="nextPage" class="btn-page" disabled>Successiva ‚Üí</button>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analyticsSection" class="section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üëÅÔ∏è</div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalPageviews">--</span>
                            <span class="stat-label">Visualizzazioni</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <span class="stat-value" id="uniqueVisitors">--</span>
                            <span class="stat-label">Visitatori Unici</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <span class="stat-value" id="formStarted">--</span>
                            <span class="stat-label">Form Iniziati</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úâÔ∏è</div>
                        <div class="stat-info">
                            <span class="stat-value" id="formSubmitted">--</span>
                            <span class="stat-label">Form Inviati</span>
                        </div>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-card wide">
                        <h3>Andamento Giornaliero</h3>
                        <div id="dailyChart" class="daily-chart">
                            <div class="chart-lines" id="dailyLines"></div>
                        </div>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-card">
                        <h3>Errori Form pi√π Comuni</h3>
                        <div id="formErrors" class="error-list"></div>
                    </div>
                    <div class="chart-card">
                        <h3>Eventi Recenti</h3>
                        <div id="recentEvents" class="events-list"></div>
                    </div>
                </div>

                <!-- Funnel Analysis -->
                <div class="chart-card wide">
                    <h3>üìä Funnel di Conversione</h3>
                    <div id="funnelChart" class="funnel-container"></div>
                </div>

                <!-- Additional Stats Row -->
                <div class="stats-grid small">
                    <div class="stat-card mini">
                        <div class="stat-info">
                            <span class="stat-value" id="avgEngagement">--</span>
                            <span class="stat-label">Engagement Medio</span>
                        </div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-info">
                            <span class="stat-value" id="formConversion">--%</span>
                            <span class="stat-label">Conversione Form</span>
                        </div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-info">
                            <span class="stat-value" id="todayVisitors">--</span>
                            <span class="stat-label">Visitatori Oggi</span>
                        </div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-info">
                            <span class="stat-value" id="puzzleAvgTime">--</span>
                            <span class="stat-label">Tempo Medio Puzzle</span>
                        </div>
                    </div>
                </div>

                <!-- Scroll Depth & Devices Row -->
                <div class="charts-row">
                    <div class="chart-card">
                        <h3>üìú Scroll Depth</h3>
                        <div id="scrollDepthChart" class="scroll-chart"></div>
                    </div>
                    <div class="chart-card">
                        <h3>üì± Dispositivi</h3>
                        <div id="devicesChart" class="devices-list"></div>
                    </div>
                </div>

                <!-- Top Pages & Hourly -->
                <div class="charts-row">
                    <div class="chart-card">
                        <h3>üîù Pagine Pi√π Visitate</h3>
                        <div id="topPagesChart" class="top-pages-list"></div>
                    </div>
                    <div class="chart-card">
                        <h3>üïê Distribuzione Oraria</h3>
                        <div id="hourlyChart" class="hourly-chart"></div>
                    </div>
                </div>

                <!-- Performance (Core Web Vitals) -->
                <div class="chart-card wide">
                    <h3>‚ö° Core Web Vitals</h3>
                    <div id="performanceChart" class="performance-grid"></div>
                </div>
            </section>

            <!-- Logs Section -->
            <section id="logsSection" class="section">
                <div class="table-container full">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data/Ora</th>
                                <th>Azione</th>
                                <th>Entit√†</th>
                                <th>Dettagli</th>
                                <th>IP</th>
                            </tr>
                        </thead>
                        <tbody id="logsTable">
                            <tr>
                                <td colspan="5" class="loading">Caricamento...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Dettagli Iscrizione -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Dettagli Iscrizione</h2>
                <button class="modal-close" id="closeModal">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Contenuto dinamico -->
            </div>
            <div class="modal-footer">
                <button class="btn-modal approve" id="modalApprove">‚úÖ Approva</button>
                <button class="btn-modal reject" id="modalReject">‚ùå Rifiuta</button>
                <button class="btn-modal delete" id="modalDelete">üóëÔ∏è Elimina</button>
                <button class="btn-modal close" id="modalCancel">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="../js/admin/dashboard.js"></script>
</body>
</html>

